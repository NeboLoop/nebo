// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: plugins.sql

package db

import (
	"context"
	"database/sql"
)

const createPlugin = `-- name: CreatePlugin :one
INSERT INTO plugin_registry (id, name, plugin_type, display_name, description, icon, version, is_enabled, is_installed, settings_manifest, metadata, created_at, updated_at)
VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, unixepoch(), unixepoch())
RETURNING id, name, plugin_type, display_name, description, icon, version, is_enabled, is_installed, settings_manifest, connection_status, last_connected_at, last_error, metadata, created_at, updated_at
`

type CreatePluginParams struct {
	ID               string `json:"id"`
	Name             string `json:"name"`
	PluginType       string `json:"plugin_type"`
	DisplayName      string `json:"display_name"`
	Description      string `json:"description"`
	Icon             string `json:"icon"`
	Version          string `json:"version"`
	IsEnabled        int64  `json:"is_enabled"`
	IsInstalled      int64  `json:"is_installed"`
	SettingsManifest string `json:"settings_manifest"`
	Metadata         string `json:"metadata"`
}

func (q *Queries) CreatePlugin(ctx context.Context, arg CreatePluginParams) (PluginRegistry, error) {
	row := q.db.QueryRowContext(ctx, createPlugin,
		arg.ID,
		arg.Name,
		arg.PluginType,
		arg.DisplayName,
		arg.Description,
		arg.Icon,
		arg.Version,
		arg.IsEnabled,
		arg.IsInstalled,
		arg.SettingsManifest,
		arg.Metadata,
	)
	var i PluginRegistry
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.PluginType,
		&i.DisplayName,
		&i.Description,
		&i.Icon,
		&i.Version,
		&i.IsEnabled,
		&i.IsInstalled,
		&i.SettingsManifest,
		&i.ConnectionStatus,
		&i.LastConnectedAt,
		&i.LastError,
		&i.Metadata,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const deletePlugin = `-- name: DeletePlugin :exec
DELETE FROM plugin_registry WHERE id = ?
`

func (q *Queries) DeletePlugin(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, deletePlugin, id)
	return err
}

const deletePluginSetting = `-- name: DeletePluginSetting :exec
DELETE FROM plugin_settings WHERE plugin_id = ? AND setting_key = ?
`

type DeletePluginSettingParams struct {
	PluginID   string `json:"plugin_id"`
	SettingKey string `json:"setting_key"`
}

func (q *Queries) DeletePluginSetting(ctx context.Context, arg DeletePluginSettingParams) error {
	_, err := q.db.ExecContext(ctx, deletePluginSetting, arg.PluginID, arg.SettingKey)
	return err
}

const deletePluginSettings = `-- name: DeletePluginSettings :exec
DELETE FROM plugin_settings WHERE plugin_id = ?
`

func (q *Queries) DeletePluginSettings(ctx context.Context, pluginID string) error {
	_, err := q.db.ExecContext(ctx, deletePluginSettings, pluginID)
	return err
}

const getPlugin = `-- name: GetPlugin :one
SELECT id, name, plugin_type, display_name, description, icon, version, is_enabled, is_installed, settings_manifest, connection_status, last_connected_at, last_error, metadata, created_at, updated_at FROM plugin_registry WHERE id = ?
`

func (q *Queries) GetPlugin(ctx context.Context, id string) (PluginRegistry, error) {
	row := q.db.QueryRowContext(ctx, getPlugin, id)
	var i PluginRegistry
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.PluginType,
		&i.DisplayName,
		&i.Description,
		&i.Icon,
		&i.Version,
		&i.IsEnabled,
		&i.IsInstalled,
		&i.SettingsManifest,
		&i.ConnectionStatus,
		&i.LastConnectedAt,
		&i.LastError,
		&i.Metadata,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getPluginByName = `-- name: GetPluginByName :one
SELECT id, name, plugin_type, display_name, description, icon, version, is_enabled, is_installed, settings_manifest, connection_status, last_connected_at, last_error, metadata, created_at, updated_at FROM plugin_registry WHERE name = ?
`

func (q *Queries) GetPluginByName(ctx context.Context, name string) (PluginRegistry, error) {
	row := q.db.QueryRowContext(ctx, getPluginByName, name)
	var i PluginRegistry
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.PluginType,
		&i.DisplayName,
		&i.Description,
		&i.Icon,
		&i.Version,
		&i.IsEnabled,
		&i.IsInstalled,
		&i.SettingsManifest,
		&i.ConnectionStatus,
		&i.LastConnectedAt,
		&i.LastError,
		&i.Metadata,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getPluginSetting = `-- name: GetPluginSetting :one

SELECT id, plugin_id, setting_key, setting_value, is_secret, created_at, updated_at FROM plugin_settings WHERE plugin_id = ? AND setting_key = ?
`

type GetPluginSettingParams struct {
	PluginID   string `json:"plugin_id"`
	SettingKey string `json:"setting_key"`
}

// Plugin Settings queries (UPSERT pattern matching channel_config)
func (q *Queries) GetPluginSetting(ctx context.Context, arg GetPluginSettingParams) (PluginSetting, error) {
	row := q.db.QueryRowContext(ctx, getPluginSetting, arg.PluginID, arg.SettingKey)
	var i PluginSetting
	err := row.Scan(
		&i.ID,
		&i.PluginID,
		&i.SettingKey,
		&i.SettingValue,
		&i.IsSecret,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const listEnabledPlugins = `-- name: ListEnabledPlugins :many
SELECT id, name, plugin_type, display_name, description, icon, version, is_enabled, is_installed, settings_manifest, connection_status, last_connected_at, last_error, metadata, created_at, updated_at FROM plugin_registry WHERE is_enabled = 1 ORDER BY plugin_type, display_name
`

func (q *Queries) ListEnabledPlugins(ctx context.Context) ([]PluginRegistry, error) {
	rows, err := q.db.QueryContext(ctx, listEnabledPlugins)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PluginRegistry
	for rows.Next() {
		var i PluginRegistry
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.PluginType,
			&i.DisplayName,
			&i.Description,
			&i.Icon,
			&i.Version,
			&i.IsEnabled,
			&i.IsInstalled,
			&i.SettingsManifest,
			&i.ConnectionStatus,
			&i.LastConnectedAt,
			&i.LastError,
			&i.Metadata,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listPluginSettings = `-- name: ListPluginSettings :many
SELECT id, plugin_id, setting_key, setting_value, is_secret, created_at, updated_at FROM plugin_settings WHERE plugin_id = ? ORDER BY setting_key
`

func (q *Queries) ListPluginSettings(ctx context.Context, pluginID string) ([]PluginSetting, error) {
	rows, err := q.db.QueryContext(ctx, listPluginSettings, pluginID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PluginSetting
	for rows.Next() {
		var i PluginSetting
		if err := rows.Scan(
			&i.ID,
			&i.PluginID,
			&i.SettingKey,
			&i.SettingValue,
			&i.IsSecret,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listPlugins = `-- name: ListPlugins :many

SELECT id, name, plugin_type, display_name, description, icon, version, is_enabled, is_installed, settings_manifest, connection_status, last_connected_at, last_error, metadata, created_at, updated_at FROM plugin_registry ORDER BY plugin_type, display_name
`

// Plugin Registry queries
func (q *Queries) ListPlugins(ctx context.Context) ([]PluginRegistry, error) {
	rows, err := q.db.QueryContext(ctx, listPlugins)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PluginRegistry
	for rows.Next() {
		var i PluginRegistry
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.PluginType,
			&i.DisplayName,
			&i.Description,
			&i.Icon,
			&i.Version,
			&i.IsEnabled,
			&i.IsInstalled,
			&i.SettingsManifest,
			&i.ConnectionStatus,
			&i.LastConnectedAt,
			&i.LastError,
			&i.Metadata,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listPluginsByType = `-- name: ListPluginsByType :many
SELECT id, name, plugin_type, display_name, description, icon, version, is_enabled, is_installed, settings_manifest, connection_status, last_connected_at, last_error, metadata, created_at, updated_at FROM plugin_registry WHERE plugin_type = ? ORDER BY display_name
`

func (q *Queries) ListPluginsByType(ctx context.Context, pluginType string) ([]PluginRegistry, error) {
	rows, err := q.db.QueryContext(ctx, listPluginsByType, pluginType)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PluginRegistry
	for rows.Next() {
		var i PluginRegistry
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.PluginType,
			&i.DisplayName,
			&i.Description,
			&i.Icon,
			&i.Version,
			&i.IsEnabled,
			&i.IsInstalled,
			&i.SettingsManifest,
			&i.ConnectionStatus,
			&i.LastConnectedAt,
			&i.LastError,
			&i.Metadata,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const togglePlugin = `-- name: TogglePlugin :exec
UPDATE plugin_registry SET is_enabled = ?, updated_at = unixepoch() WHERE id = ?
`

type TogglePluginParams struct {
	IsEnabled int64  `json:"is_enabled"`
	ID        string `json:"id"`
}

func (q *Queries) TogglePlugin(ctx context.Context, arg TogglePluginParams) error {
	_, err := q.db.ExecContext(ctx, togglePlugin, arg.IsEnabled, arg.ID)
	return err
}

const updatePlugin = `-- name: UpdatePlugin :exec
UPDATE plugin_registry
SET display_name = ?, description = ?, icon = ?, version = ?,
    is_enabled = ?, settings_manifest = ?, metadata = ?,
    updated_at = unixepoch()
WHERE id = ?
`

type UpdatePluginParams struct {
	DisplayName      string `json:"display_name"`
	Description      string `json:"description"`
	Icon             string `json:"icon"`
	Version          string `json:"version"`
	IsEnabled        int64  `json:"is_enabled"`
	SettingsManifest string `json:"settings_manifest"`
	Metadata         string `json:"metadata"`
	ID               string `json:"id"`
}

func (q *Queries) UpdatePlugin(ctx context.Context, arg UpdatePluginParams) error {
	_, err := q.db.ExecContext(ctx, updatePlugin,
		arg.DisplayName,
		arg.Description,
		arg.Icon,
		arg.Version,
		arg.IsEnabled,
		arg.SettingsManifest,
		arg.Metadata,
		arg.ID,
	)
	return err
}

const updatePluginStatus = `-- name: UpdatePluginStatus :exec
UPDATE plugin_registry
SET connection_status = ?, last_connected_at = ?, last_error = ?,
    updated_at = unixepoch()
WHERE id = ?
`

type UpdatePluginStatusParams struct {
	ConnectionStatus string         `json:"connection_status"`
	LastConnectedAt  sql.NullInt64  `json:"last_connected_at"`
	LastError        sql.NullString `json:"last_error"`
	ID               string         `json:"id"`
}

func (q *Queries) UpdatePluginStatus(ctx context.Context, arg UpdatePluginStatusParams) error {
	_, err := q.db.ExecContext(ctx, updatePluginStatus,
		arg.ConnectionStatus,
		arg.LastConnectedAt,
		arg.LastError,
		arg.ID,
	)
	return err
}

const upsertPluginSetting = `-- name: UpsertPluginSetting :one
INSERT INTO plugin_settings (id, plugin_id, setting_key, setting_value, is_secret, created_at, updated_at)
VALUES (?, ?, ?, ?, ?, unixepoch(), unixepoch())
ON CONFLICT(plugin_id, setting_key) DO UPDATE SET
    setting_value = excluded.setting_value,
    is_secret = excluded.is_secret,
    updated_at = unixepoch()
RETURNING id, plugin_id, setting_key, setting_value, is_secret, created_at, updated_at
`

type UpsertPluginSettingParams struct {
	ID           string `json:"id"`
	PluginID     string `json:"plugin_id"`
	SettingKey   string `json:"setting_key"`
	SettingValue string `json:"setting_value"`
	IsSecret     int64  `json:"is_secret"`
}

func (q *Queries) UpsertPluginSetting(ctx context.Context, arg UpsertPluginSettingParams) (PluginSetting, error) {
	row := q.db.QueryRowContext(ctx, upsertPluginSetting,
		arg.ID,
		arg.PluginID,
		arg.SettingKey,
		arg.SettingValue,
		arg.IsSecret,
	)
	var i PluginSetting
	err := row.Scan(
		&i.ID,
		&i.PluginID,
		&i.SettingKey,
		&i.SettingValue,
		&i.IsSecret,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
