// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: cron_jobs.sql

package db

import (
	"context"
	"database/sql"
)

const countCronHistory = `-- name: CountCronHistory :one
SELECT COUNT(*) as total FROM cron_history WHERE job_id = ?
`

func (q *Queries) CountCronHistory(ctx context.Context, jobID int64) (int64, error) {
	row := q.db.QueryRowContext(ctx, countCronHistory, jobID)
	var total int64
	err := row.Scan(&total)
	return total, err
}

const countCronJobs = `-- name: CountCronJobs :one
SELECT COUNT(*) as total FROM cron_jobs
`

func (q *Queries) CountCronJobs(ctx context.Context) (int64, error) {
	row := q.db.QueryRowContext(ctx, countCronJobs)
	var total int64
	err := row.Scan(&total)
	return total, err
}

const createCronHistory = `-- name: CreateCronHistory :one

INSERT INTO cron_history (job_id, started_at)
VALUES (?, CURRENT_TIMESTAMP)
RETURNING id, job_id, started_at, finished_at, success, output, error
`

// Cron history queries
func (q *Queries) CreateCronHistory(ctx context.Context, jobID int64) (CronHistory, error) {
	row := q.db.QueryRowContext(ctx, createCronHistory, jobID)
	var i CronHistory
	err := row.Scan(
		&i.ID,
		&i.JobID,
		&i.StartedAt,
		&i.FinishedAt,
		&i.Success,
		&i.Output,
		&i.Error,
	)
	return i, err
}

const createCronJob = `-- name: CreateCronJob :one
INSERT INTO cron_jobs (name, schedule, command, task_type, message, deliver, enabled)
VALUES (?, ?, ?, ?, ?, ?, ?)
RETURNING id, name, schedule, command, task_type, message, deliver, enabled, last_run, run_count, last_error, created_at
`

type CreateCronJobParams struct {
	Name     string         `json:"name"`
	Schedule string         `json:"schedule"`
	Command  string         `json:"command"`
	TaskType string         `json:"task_type"`
	Message  sql.NullString `json:"message"`
	Deliver  sql.NullString `json:"deliver"`
	Enabled  sql.NullInt64  `json:"enabled"`
}

func (q *Queries) CreateCronJob(ctx context.Context, arg CreateCronJobParams) (CronJob, error) {
	row := q.db.QueryRowContext(ctx, createCronJob,
		arg.Name,
		arg.Schedule,
		arg.Command,
		arg.TaskType,
		arg.Message,
		arg.Deliver,
		arg.Enabled,
	)
	var i CronJob
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Schedule,
		&i.Command,
		&i.TaskType,
		&i.Message,
		&i.Deliver,
		&i.Enabled,
		&i.LastRun,
		&i.RunCount,
		&i.LastError,
		&i.CreatedAt,
	)
	return i, err
}

const deleteCronJob = `-- name: DeleteCronJob :exec
DELETE FROM cron_jobs WHERE id = ?
`

func (q *Queries) DeleteCronJob(ctx context.Context, id int64) error {
	_, err := q.db.ExecContext(ctx, deleteCronJob, id)
	return err
}

const getCronJob = `-- name: GetCronJob :one
SELECT id, name, schedule, command, task_type, message, deliver, enabled, last_run, run_count, last_error, created_at
FROM cron_jobs
WHERE id = ?
`

func (q *Queries) GetCronJob(ctx context.Context, id int64) (CronJob, error) {
	row := q.db.QueryRowContext(ctx, getCronJob, id)
	var i CronJob
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Schedule,
		&i.Command,
		&i.TaskType,
		&i.Message,
		&i.Deliver,
		&i.Enabled,
		&i.LastRun,
		&i.RunCount,
		&i.LastError,
		&i.CreatedAt,
	)
	return i, err
}

const getCronJobByName = `-- name: GetCronJobByName :one
SELECT id, name, schedule, command, task_type, message, deliver, enabled, last_run, run_count, last_error, created_at
FROM cron_jobs
WHERE name = ?
`

func (q *Queries) GetCronJobByName(ctx context.Context, name string) (CronJob, error) {
	row := q.db.QueryRowContext(ctx, getCronJobByName, name)
	var i CronJob
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Schedule,
		&i.Command,
		&i.TaskType,
		&i.Message,
		&i.Deliver,
		&i.Enabled,
		&i.LastRun,
		&i.RunCount,
		&i.LastError,
		&i.CreatedAt,
	)
	return i, err
}

const getRecentCronHistory = `-- name: GetRecentCronHistory :many
SELECT id, job_id, started_at, finished_at, success, output, error
FROM cron_history
WHERE job_id = ?
ORDER BY started_at DESC
LIMIT 10
`

func (q *Queries) GetRecentCronHistory(ctx context.Context, jobID int64) ([]CronHistory, error) {
	rows, err := q.db.QueryContext(ctx, getRecentCronHistory, jobID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CronHistory
	for rows.Next() {
		var i CronHistory
		if err := rows.Scan(
			&i.ID,
			&i.JobID,
			&i.StartedAt,
			&i.FinishedAt,
			&i.Success,
			&i.Output,
			&i.Error,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listCronHistory = `-- name: ListCronHistory :many
SELECT id, job_id, started_at, finished_at, success, output, error
FROM cron_history
WHERE job_id = ?
ORDER BY started_at DESC
LIMIT ?3 OFFSET ?2
`

type ListCronHistoryParams struct {
	JobID  int64 `json:"job_id"`
	Limit  int64 `json:"limit"`
	Offset int64 `json:"offset"`
}

func (q *Queries) ListCronHistory(ctx context.Context, arg ListCronHistoryParams) ([]CronHistory, error) {
	rows, err := q.db.QueryContext(ctx, listCronHistory, arg.JobID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CronHistory
	for rows.Next() {
		var i CronHistory
		if err := rows.Scan(
			&i.ID,
			&i.JobID,
			&i.StartedAt,
			&i.FinishedAt,
			&i.Success,
			&i.Output,
			&i.Error,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listCronJobs = `-- name: ListCronJobs :many

SELECT id, name, schedule, command, task_type, message, deliver, enabled, last_run, run_count, last_error, created_at
FROM cron_jobs
ORDER BY created_at DESC
LIMIT ?2 OFFSET ?1
`

type ListCronJobsParams struct {
	Offset int64 `json:"offset"`
	Limit  int64 `json:"limit"`
}

// Cron job queries
func (q *Queries) ListCronJobs(ctx context.Context, arg ListCronJobsParams) ([]CronJob, error) {
	rows, err := q.db.QueryContext(ctx, listCronJobs, arg.Offset, arg.Limit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CronJob
	for rows.Next() {
		var i CronJob
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Schedule,
			&i.Command,
			&i.TaskType,
			&i.Message,
			&i.Deliver,
			&i.Enabled,
			&i.LastRun,
			&i.RunCount,
			&i.LastError,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listEnabledCronJobs = `-- name: ListEnabledCronJobs :many
SELECT id, name, schedule, command, task_type, message, deliver, enabled, last_run, run_count, last_error, created_at
FROM cron_jobs
WHERE enabled = 1
ORDER BY name
`

func (q *Queries) ListEnabledCronJobs(ctx context.Context) ([]CronJob, error) {
	rows, err := q.db.QueryContext(ctx, listEnabledCronJobs)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CronJob
	for rows.Next() {
		var i CronJob
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Schedule,
			&i.Command,
			&i.TaskType,
			&i.Message,
			&i.Deliver,
			&i.Enabled,
			&i.LastRun,
			&i.RunCount,
			&i.LastError,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const setCronJobEnabled = `-- name: SetCronJobEnabled :exec
UPDATE cron_jobs
SET enabled = ?
WHERE id = ?
`

type SetCronJobEnabledParams struct {
	Enabled sql.NullInt64 `json:"enabled"`
	ID      int64         `json:"id"`
}

func (q *Queries) SetCronJobEnabled(ctx context.Context, arg SetCronJobEnabledParams) error {
	_, err := q.db.ExecContext(ctx, setCronJobEnabled, arg.Enabled, arg.ID)
	return err
}

const toggleCronJob = `-- name: ToggleCronJob :exec
UPDATE cron_jobs
SET enabled = NOT enabled
WHERE id = ?
`

func (q *Queries) ToggleCronJob(ctx context.Context, id int64) error {
	_, err := q.db.ExecContext(ctx, toggleCronJob, id)
	return err
}

const updateCronHistory = `-- name: UpdateCronHistory :exec
UPDATE cron_history
SET finished_at = CURRENT_TIMESTAMP,
    success = ?,
    output = ?,
    error = ?
WHERE id = ?
`

type UpdateCronHistoryParams struct {
	Success sql.NullInt64  `json:"success"`
	Output  sql.NullString `json:"output"`
	Error   sql.NullString `json:"error"`
	ID      int64          `json:"id"`
}

func (q *Queries) UpdateCronHistory(ctx context.Context, arg UpdateCronHistoryParams) error {
	_, err := q.db.ExecContext(ctx, updateCronHistory,
		arg.Success,
		arg.Output,
		arg.Error,
		arg.ID,
	)
	return err
}

const updateCronJob = `-- name: UpdateCronJob :exec
UPDATE cron_jobs
SET name = COALESCE(?1, name),
    schedule = COALESCE(?2, schedule),
    command = COALESCE(?3, command),
    task_type = COALESCE(?4, task_type),
    message = COALESCE(?5, message),
    deliver = COALESCE(?6, deliver)
WHERE id = ?7
`

type UpdateCronJobParams struct {
	Name     sql.NullString `json:"name"`
	Schedule sql.NullString `json:"schedule"`
	Command  sql.NullString `json:"command"`
	TaskType sql.NullString `json:"task_type"`
	Message  sql.NullString `json:"message"`
	Deliver  sql.NullString `json:"deliver"`
	ID       int64          `json:"id"`
}

func (q *Queries) UpdateCronJob(ctx context.Context, arg UpdateCronJobParams) error {
	_, err := q.db.ExecContext(ctx, updateCronJob,
		arg.Name,
		arg.Schedule,
		arg.Command,
		arg.TaskType,
		arg.Message,
		arg.Deliver,
		arg.ID,
	)
	return err
}

const updateCronJobLastRun = `-- name: UpdateCronJobLastRun :exec
UPDATE cron_jobs
SET last_run = CURRENT_TIMESTAMP,
    run_count = run_count + 1,
    last_error = ?1
WHERE id = ?2
`

type UpdateCronJobLastRunParams struct {
	LastError sql.NullString `json:"last_error"`
	ID        int64          `json:"id"`
}

func (q *Queries) UpdateCronJobLastRun(ctx context.Context, arg UpdateCronJobLastRunParams) error {
	_, err := q.db.ExecContext(ctx, updateCronJobLastRun, arg.LastError, arg.ID)
	return err
}
